version: "3.8"

networks:
  wnt_net:
    external: true

services:
  traefik:
    image: traefik:v3.1
    command:
      - --log.level=INFO

      # Docker Swarm provider
      - --providers.swarm=true
      - --providers.swarm.exposedByDefault=false
      - --providers.swarm.network=wnt_net

      # EntryPoint (HTTP only; TLS offloaded at CloudFront)
      - --entryPoints.web.address=:80

      # (Optional but useful) dashboard on :8080 inside the cluster only
      - --api.dashboard=true

    ports:
      - "80:80"
      # If you ever want to reach dashboard from outside, publish 8080 carefully.
      # - "8080:8080"

    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro

    networks:
      - wnt_net

    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints:
          - node.role == manager
      restart_policy:
        condition: on-failure
